define(["durandal/system"],function(e){var t=/\s+/,i=function(){},n=function(e,t){this.owner=e,this.events=t};return n.prototype.then=function(e,t){return this.callback=e||this.callback,this.context=t||this.context,this.callback?(this.owner.on(this.events,this.callback,this.context),this):this},n.prototype.on=n.prototype.then,n.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},i.prototype.on=function(e,i,a){var r,o,c;if(i){for(r=this.callbacks||(this.callbacks={}),e=e.split(t);o=e.shift();)c=r[o]||(r[o]=[]),c.push(i,a);return this}return new n(this,e)},i.prototype.off=function(i,n,a){var r,o,c,s;if(!(o=this.callbacks))return this;if(!(i||n||a))return delete this.callbacks,this;for(i=i?i.split(t):e.keys(o);r=i.shift();)if((c=o[r])&&(n||a))for(s=c.length-2;s>=0;s-=2)n&&c[s]!==n||a&&c[s+1]!==a||c.splice(s,2);else delete o[r];return this},i.prototype.trigger=function(e){var i,n,a,r,o,c,s,l;if(!(n=this.callbacks))return this;for(l=[],e=e.split(t),r=1,o=arguments.length;o>r;r++)l[r-1]=arguments[r];for(;i=e.shift();){if((s=n.all)&&(s=s.slice()),(a=n[i])&&(a=a.slice()),a)for(r=0,o=a.length;o>r;r+=2)a[r].apply(a[r+1]||this,l);if(s)for(c=[i].concat(l),r=0,o=s.length;o>r;r+=2)s[r].apply(s[r+1]||this,c)}return this},i.prototype.proxy=function(e){var t=this;return function(i){t.trigger(e,i)}},i.includeIn=function(e){e.on=i.prototype.on,e.off=i.prototype.off,e.trigger=i.prototype.trigger,e.proxy=i.prototype.proxy},i});