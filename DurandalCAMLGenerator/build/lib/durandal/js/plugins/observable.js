define(["durandal/system","durandal/binder","knockout"],function(e,t,n){function i(e){var t=e[0];return"_"===t||"$"===t}function a(t){if(!t||e.isElement(t)||t.ko===n||t.jquery)return!1;var i=d.call(t);return-1==f.indexOf(i)&&!(t===!0||t===!1)}function r(e,t){var n=e.__observable__,i=!0;if(!n||!n.__full__){n=n||(e.__observable__={}),n.__full__=!0,v.forEach(function(n){e[n]=function(){i=!1;var e=m[n].apply(t,arguments);return i=!0,e}}),p.forEach(function(n){e[n]=function(){i&&t.valueWillMutate();var a=h[n].apply(e,arguments);return i&&t.valueHasMutated(),a}}),g.forEach(function(n){e[n]=function(){for(var a=0,r=arguments.length;r>a;a++)o(arguments[a]);i&&t.valueWillMutate();var s=h[n].apply(e,arguments);return i&&t.valueHasMutated(),s}}),e.splice=function(){for(var n=2,a=arguments.length;a>n;n++)o(arguments[n]);i&&t.valueWillMutate();var r=h.splice.apply(e,arguments);return i&&t.valueHasMutated(),r};for(var a=0,r=e.length;r>a;a++)o(e[a])}}function o(t){var o,s;if(a(t)&&(o=t.__observable__,!o||!o.__full__)){if(o=o||(t.__observable__={}),o.__full__=!0,e.isArray(t)){var l=n.observableArray(t);r(t,l)}else for(var u in t)i(u)||o[u]||(s=t[u],e.isFunction(s)||c(t,u,s));y&&e.log("Converted",t)}}function s(e,t,n){var i;e(t),i=e.peek(),n?i.destroyAll||(i||(i=[],e(i)),r(i,e)):o(i)}function c(t,i,a){var c,l,u=t.__observable__||(t.__observable__={});if(void 0===a&&(a=t[i]),e.isArray(a))c=n.observableArray(a),r(a,c),l=!0;else if("function"==typeof a){if(!n.isObservable(a))return null;c=a}else e.isPromise(a)?(c=n.observable(),a.then(function(t){if(e.isArray(t)){var i=n.observableArray(t);r(t,i),t=i}c(t)})):(c=n.observable(a),o(a));return Object.defineProperty(t,i,{configurable:!0,enumerable:!0,get:c,set:n.isWriteableObservable(c)?function(t){t&&e.isPromise(t)?t.then(function(t){s(c,t,e.isArray(t))}):s(c,t,l)}:void 0}),u[i]=c,c}function l(t,n,i){var a,r=this,o={owner:t,deferEvaluation:!0};return"function"==typeof i?o.read=i:("value"in i&&e.error('For ko.defineProperty, you must not specify a "value" for the property. You must provide a "get" function.'),"function"!=typeof i.get&&e.error('For ko.defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".'),o.read=i.get,o.write=i.set),a=r.computed(o),t[n]=a,c(t,n,a)}var u,d=Object.prototype.toString,f=["[object Function]","[object String]","[object Boolean]","[object Number]","[object Date]","[object RegExp]"],v=["remove","removeAll","destroy","destroyAll","replace"],p=["pop","reverse","sort","shift","splice"],g=["push","unshift"],h=Array.prototype,m=n.observableArray.fn,y=!1;return u=function(e,t){var i,a,r;return e?(i=e.__observable__,i&&(a=i[t])?a:(r=e[t],n.isObservable(r)?r:c(e,t,r))):null},u.defineProperty=l,u.convertProperty=c,u.convertObject=o,u.install=function(e){var n=t.beforeBind;t.binding=function(e,t,i){i.applyBindings&&!i.skipConversion&&o(e),n(e,t)},y=e.logConversion},u});